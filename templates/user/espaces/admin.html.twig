{% extends "layoutAdmin.html.twig" %}
{% block stylesheets %}
<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
<link href="{{ asset('template/assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css') }}" rel="stylesheet" type="text/css"/>
<link href="{{ asset('template/assets/global/plugins/fullcalendar/fullcalendar.min.css') }}" rel="stylesheet" type="text/css"/>
<link href="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/jqvmap.css') }}" rel="stylesheet" type="text/css"/>
<link href="{{ asset('template/assets/global/plugins/morris/morris.css') }}" rel="stylesheet" type="text/css">
<!-- END PAGE LEVEL PLUGIN STYLES -->
<!-- BEGIN PAGE STYLES -->
<link href="{{ asset('template/assets/admin/pages/css/tasks.css') }}" rel="stylesheet" type="text/css"/>
<!-- END PAGE STYLES -->
<style type="text/css">
    .number-stats .stat-left{
        float: inherit;
    }
    .number-stats .stat-left .stat-number{
        text-align: center !important;
    }
    .commandes_no_valides td{
        text-align: left;
        font-weight: 100;
    }
    .commandes_no_valides .adress, .commandes_no_valides .nom{
        font-size: 9px;
    }
    .validate-tag{
        color: #009624;
        font-weight: bold;
    }
    #table-stats tbody tr td{
        font-weight: 100;
    }
</style>
{% endblock %}
{% block title %}Tableau de bord{% endblock %}
{% block body %}
    <div class="page-content-wrapper">
        <div class="page-content">
            <!-- BEGIN PAGE HEAD -->
            <div class="page-head">
                <!-- BEGIN PAGE TITLE -->
                <div class="page-title">
                    <h1>Tableau de bord <small>statistiques et rapports</small></h1>
                </div>
                <!-- END PAGE TITLE -->
            </div>
            <!-- END PAGE HEAD -->
            <!-- BEGIN PAGE BREADCRUMB -->
            <ul class="page-breadcrumb breadcrumb hide">
                <li>
                    <a href="javascript:;">Home</a><i class="fa fa-circle"></i>
                </li>
                <li class="active">
                    Dashboard
                </li>
            </ul>
            <!-- END PAGE BREADCRUMB -->
            <!-- BEGIN PAGE CONTENT INNER -->
            <div class="row margin-top-10">
                <div class="col-md-12 col-sm-12">
                    <!-- BEGIN PORTLET-->
                    <div class="portlet light ">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font-color hide"></i>
                                <span class="caption-subject theme-font-color bold uppercase">Nouvelles Commandes</span>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <table class="table table-hover commandes_no_valides">
                                <tr>
                                    <th>Client</th>
                                    <th>Adresse</th>
                                    <th>Téléphone</th>
                                    <th>Produits</th>
                                    <th>Marchand</th>
                                    <th></th>
                                </tr>
                                {% for commande in commandes_no_valides %}
                                    <tr>
                                        <td class="nom">{{commande.nom}} {{commande.prenom}}</td>
                                        <td class="adress">{{ commande.adress }}</td>
                                        <td>{{ commande.phone }}</td>
                                        <td>{{ commande.marchand }}</td>
                                        <td>
                                            <ul>
                                                {% for k,product in commande.products %}
                                                    <li><a href="{{ path('product_page', {slug:product}) }}">product {% if(commande.products|length > 1) %}{{k+1}}{% endif %}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </td>
                                        <td id="bloc-validate-{{commande.id}}"><button type="button" class="btn btn-primary btn-sm validate-cmd" data-id="{{commande.id}}">Valider</button></td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                    <div class="portlet light ">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font-color hide"></i>
                                <span class="caption-subject theme-font-color bold uppercase">Revenu</span>
                            </div>
                            <div class="actions">
                                <select id="filterCmdGlobal" class="form-control">
                                    <option value="this_year">Cette année</option>
                                    {% for k,month in months %}
                                        <option value="{{k}}">{{month}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div id="myChart" style="width:100%; height:500px;"></div>
                            <table id="table-stats" class="table table-hover">
                                <thead>
                                    <tr><td>Mois</td><td>Revenu</td></tr>
                                </thead>
                                <tbody>
                                    {% for revenu in revenus_table %}
                                        <tr>
                                            <td>{{revenu[0]}}</td>
                                            <td>{{revenu[1]}} DT</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- END PORTLET-->
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <small>Commandes</small>
                                <h3 class="font-green-sharp">50 <span style="font-size: 16px;">Validés</span>{#<small class="font-green-sharp">$</small>#}</h3>
                                <h3 class="font-red">10 <span style="font-size: 16px;">En cours</span>{#<small class="font-green-sharp">$</small>#}</h3>
                                
                            </div>
                            <div class="icon">
                                <i class="icon-basket"></i>
                            </div>
                        </div>
                        {#<div class="progress-info">
                            <div class="progress">
                                <span style="width: 76%;" class="progress-bar progress-bar-success green-sharp">
                                    <span class="sr-only">76% progress</span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    progress
                                </div>
                                <div class="status-number">
                                    76%
                                </div>
                            </div>
                        </div>#}
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-red-haze">2</h3>
                                <small>Visites</small>
                            </div>
                            <div class="icon">
                                <i class="icon-like"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-blue-sharp">567</h3>
                                <small>NEW ORDERS</small>
                            </div>
                            <div class="icon">
                                <i class="icon-basket"></i>
                            </div>
                        </div>
                        <div class="progress-info">
                            <div class="progress">
                                <span style="width: 45%;" class="progress-bar progress-bar-success blue-sharp">
                                    <span class="sr-only">45% grow</span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    grow
                                </div>
                                <div class="status-number">
                                    45%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-purple-soft">276</h3>
                                <small>NEW USERS</small>
                            </div>
                            <div class="icon">
                                <i class="icon-user"></i>
                            </div>
                        </div>
                        <div class="progress-info">
                            <div class="progress">
                                <span style="width: 57%;" class="progress-bar progress-bar-success purple-soft">
                                    <span class="sr-only">56% change</span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    change
                                </div>
                                <div class="status-number">
                                    57%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END PAGE CONTENT INNER -->
        </div>
    </div>
{% endblock %}
{% block javascripts %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/jquery.vmap.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js') }}" type="text/javascript"></script>
<!-- IMPORTANT! fullcalendar depends on jquery-ui.min.js for drag & drop support -->
<script src="{{ asset('template/assets/global/plugins/morris/morris.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/morris/raphael-min.js') }}" type="text/javascript"></script>
<script src="{{ asset('template/assets/global/plugins/jquery.sparkline.min.js') }}" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="{{ asset('custom/js/loader.js') }}"></script>
<script type="text/javascript" src="{{ asset('custom/js/dash.js') }}"></script>
<script>

google.charts.load('current',{packages:['corechart']});
google.charts.setOnLoadCallback(drawChart);
    $(document).ready(function () {
        $('.validate-cmd').click(function (argument) {
            var id = $(this).data('id');
            $.ajax({
                url: "{{ path('admin_validate_cmd') }}",
                method: "POST",
                data: {id:id},
                error: function ()
                {
                    alert('une erreur');
                },
                beforeSend: function ()
                {
                    
                },
                success: function (result)
                {
                    $(this).hide();
                    $('#bloc-validate-'+id).html('<span class="validate-tag"><i class="fa fa-check"></i>Validé</span>')
                }
            });
        });
        $('#filterCmdGlobal').change(function (argument) {
            $.ajax({
                
                url: '{{ path('dashboard_cmd_revenu') }}',
                method: "GET",
                data: {period:$('#filterCmdGlobal').val()},
                error: function ()
                {
                    alert('une erreur');
                },
                beforeSend: function ()
                {
                    
                },
                success: function (data)
                {
                    var revenus = data.revenus;
                    $('#table-stats tbody').html('');
                    if(revenus.length > 1){
                        var type = 'line';
                        createChart(data.revenus, data.entity, type);
                        $.each(revenus, function( index, value ) {
                            if(index > 0){
                                $('#table-stats tbody').append('<tr><td>'+value[0]+'</td><td>'+value[1]+'</td></tr>');
                            }
                        });
                    }else{
                        $('#table-stats tbody').html('<tr><td colspan="2" style="text-align: centrer;">Pas de données</td></tr>');
                    }
                    $('#modalFilterCmd').modal('toggle'); 
                }
            });
        });
    });
function createChart(result, entity, typeChart) {
     // Draw
    if(typeChart == 'line'){
        var data = new google.visualization.arrayToDataTable(result);
        // Set Options
        
        var options = {
          title: '',
          hAxis: {title: entity},
          vAxis: {title: 'Revenu'},
          legend: 'none'
        };
        var chart = new google.visualization.LineChart(document.getElementById('myChart'));

        chart.draw(data, options);
    }
}
function drawChart() {
// Set Data
var data = google.visualization.arrayToDataTable([
  ['Price', 'Revenu'],
  {{revenus_chart|raw}}
]);
// Set Options
var options = {
  title: '',
  hAxis: {title: 'Mois'},
  vAxis: {title: ''},
  legend: 'none'
};
// Draw
var chart = new google.visualization.LineChart(document.getElementById('myChart'));
chart.draw(data, options);
}
</script>
<script>
jQuery(document).ready(function () {
    Metronic.init(); // init metronic core components
    Layout.init(); // init current layout
    Demo.init(); // init demo features
    //TableAdvanced.init();
});
</script>

{% endblock %}